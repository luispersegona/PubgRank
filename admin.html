<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel Admin - PubgRank</title>
    <link rel="icon" type="image/x-icon" href="./images/test1.PNG" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body class="bg-black text-white min-h-screen">
    <nav class="nav-blur bg-black/30 border-b border-white/10 py-4">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
        <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700">Painel Admin</h1>
        <button id="logoutBtn" class="bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg transition-colors">Sair</button>
      </div>
    </nav>

    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <h2 class="text-4xl font-bold mb-8 text-center">Controle do Bot</h2>

      <div class="bg-white/5 border border-white/10 p-8 rounded-2xl">
        <h3 class="text-2xl font-semibold mb-4">Gerenciar Publicações</h3>
        <p class="text-white/70 mb-4">Envie um comando para o bot fazer uma publicação no Discord.</p>
        
        <form id="publishForm" class="space-y-4">
          <div>
            <label for="postContent" class="block text-sm font-medium text-white/70">Conteúdo da Publicação</label>
            <textarea
              id="postContent"
              name="postContent"
              rows="4"
              class="mt-1 block w-full px-3 py-2 bg-white/5 border border-white/10 rounded-md text-white/90 focus:outline-none focus:ring-red-500 focus:border-red-500"
              placeholder="Digite o conteúdo da sua publicação aqui..."
            ></textarea>
          </div>
          <div>
            <label for="imageUrl" class="block text-sm font-medium text-white/70">URL da Imagem (Opcional)</label>
            <input
              type="url"
              id="imageUrl"
              name="imageUrl"
              class="mt-1 block w-full px-3 py-2 bg-white/5 border border-white/10 rounded-md text-white/90 focus:outline-none focus:ring-red-500 focus:border-red-500"
              placeholder="Ex: https://exemplo.com/imagem.png"
            />
          </div>
          <button
            type="submit"
            class="w-full gradient-bg text-white px-4 py-2 rounded-xl font-semibold hover:opacity-90 transition-opacity"
          >
            Publicar no Discord
          </button>
          <p id="statusMessage" class="text-center mt-4"></p>
        </form>
      </div>
    </main>

    <script>
        const API_BASE_URL = 'https://pubgrank-api.squarecloud.app';
        
        // Verifica se o token existe antes de carregar a página
        window.addEventListener('load', () => {
            const token = localStorage.getItem('api_token');
            if (!token) {
                window.location.href = 'login.html';
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('api_token');
            window.location.href = 'login.html';
        });
        
        document.getElementById('publishForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const content = document.getElementById('postContent').value;
            const imageUrl = document.getElementById('imageUrl').value;
            const statusMessage = document.getElementById('statusMessage');
            const token = localStorage.getItem('api_token');
            
            // Verifica se pelo menos um campo foi preenchido
            if (!content && !imageUrl) {
                statusMessage.textContent = "❌ Você deve fornecer um conteúdo ou uma URL de imagem.";
                statusMessage.style.color = 'red';
                return;
            }

            statusMessage.textContent = "Enviando comando...";
            statusMessage.style.color = 'yellow';

            try {
                const response = await fetch(`http://localhost:5001/api/admin`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        token: token, 
                        content: content,
                        image_url: imageUrl 
                    })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    statusMessage.textContent = "Comando de publicação enviado com sucesso!";
                    statusMessage.style.color = 'green';
                    document.getElementById('postContent').value = '';
                    document.getElementById('imageUrl').value = '';
                } else {
                    statusMessage.textContent = result.message || "Falha ao enviar o comando. Tente novamente.";
                    statusMessage.style.color = 'red';
                }

            } catch (error) {
                statusMessage.textContent = "Erro de conexão. Verifique se o bot está online e a porta correta.";
                statusMessage.style.color = 'red';
                console.error("Erro:", error);
            }
        });
    </script>
  </body>
</html>
